{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Project 4 - Hackathon\n",
    "\n",
    "Predict a bioresponse, https://www.kaggle.com/c/bioresponse/data. \n",
    "\n",
    "## Problem:\n",
    "\n",
    "Create a model to predict the bioresponse of a given molecule based on its chemical properties. This problem is taken from a Kaggle competition. \n",
    "\n",
    "## Process/EDA\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\ProgramData\\Anaconda3\\lib\\site-packages\\statsmodels\\tools\\_testing.py:19: FutureWarning: pandas.util.testing is deprecated. Use the functions in the public API at pandas.testing instead.\n",
      "  import pandas.util.testing as tm\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Using matplotlib backend: Qt5Agg\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import seaborn as sns\n",
    "import matplotlib.pyplot as plt\n",
    "import pandas as pd\n",
    "import missingno as msno\n",
    "\n",
    "\n",
    "from sklearn.model_selection import train_test_split, cross_val_score, GridSearchCV\n",
    "from sklearn.preprocessing import StandardScaler\n",
    "from sklearn.svm import SVC, LinearSVC\n",
    "from sklearn.linear_model import LogisticRegression\n",
    "from sklearn.ensemble import VotingClassifier, RandomForestClassifier, ExtraTreesClassifier, BaggingClassifier\n",
    "from sklearn.metrics import log_loss\n",
    "\n",
    "%matplotlib"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "df_train_raw = pd.read_csv(\"./data/train.csv\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Activity</th>\n",
       "      <th>D1</th>\n",
       "      <th>D2</th>\n",
       "      <th>D3</th>\n",
       "      <th>D4</th>\n",
       "      <th>D5</th>\n",
       "      <th>D6</th>\n",
       "      <th>D7</th>\n",
       "      <th>D8</th>\n",
       "      <th>D9</th>\n",
       "      <th>...</th>\n",
       "      <th>D1767</th>\n",
       "      <th>D1768</th>\n",
       "      <th>D1769</th>\n",
       "      <th>D1770</th>\n",
       "      <th>D1771</th>\n",
       "      <th>D1772</th>\n",
       "      <th>D1773</th>\n",
       "      <th>D1774</th>\n",
       "      <th>D1775</th>\n",
       "      <th>D1776</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.497009</td>\n",
       "      <td>0.10</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.132956</td>\n",
       "      <td>0.678031</td>\n",
       "      <td>0.273166</td>\n",
       "      <td>0.585445</td>\n",
       "      <td>0.743663</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>0.366667</td>\n",
       "      <td>0.606291</td>\n",
       "      <td>0.05</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.111209</td>\n",
       "      <td>0.803455</td>\n",
       "      <td>0.106105</td>\n",
       "      <td>0.411754</td>\n",
       "      <td>0.836582</td>\n",
       "      <td>...</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "      <td>0.033300</td>\n",
       "      <td>0.480124</td>\n",
       "      <td>0.00</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.209791</td>\n",
       "      <td>0.610350</td>\n",
       "      <td>0.356453</td>\n",
       "      <td>0.517720</td>\n",
       "      <td>0.679051</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.538825</td>\n",
       "      <td>0.00</td>\n",
       "      <td>0.5</td>\n",
       "      <td>0.196344</td>\n",
       "      <td>0.724230</td>\n",
       "      <td>0.235606</td>\n",
       "      <td>0.288764</td>\n",
       "      <td>0.805110</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>0.100000</td>\n",
       "      <td>0.517794</td>\n",
       "      <td>0.00</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.494734</td>\n",
       "      <td>0.781422</td>\n",
       "      <td>0.154361</td>\n",
       "      <td>0.303809</td>\n",
       "      <td>0.812646</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows Ã— 1777 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   Activity        D1        D2    D3   D4        D5        D6        D7  \\\n",
       "0         1  0.000000  0.497009  0.10  0.0  0.132956  0.678031  0.273166   \n",
       "1         1  0.366667  0.606291  0.05  0.0  0.111209  0.803455  0.106105   \n",
       "2         1  0.033300  0.480124  0.00  0.0  0.209791  0.610350  0.356453   \n",
       "3         1  0.000000  0.538825  0.00  0.5  0.196344  0.724230  0.235606   \n",
       "4         0  0.100000  0.517794  0.00  0.0  0.494734  0.781422  0.154361   \n",
       "\n",
       "         D8        D9  ...  D1767  D1768  D1769  D1770  D1771  D1772  D1773  \\\n",
       "0  0.585445  0.743663  ...      0      0      0      0      0      0      0   \n",
       "1  0.411754  0.836582  ...      1      1      1      1      0      1      0   \n",
       "2  0.517720  0.679051  ...      0      0      0      0      0      0      0   \n",
       "3  0.288764  0.805110  ...      0      0      0      0      0      0      0   \n",
       "4  0.303809  0.812646  ...      0      0      0      0      0      0      0   \n",
       "\n",
       "   D1774  D1775  D1776  \n",
       "0      0      0      0  \n",
       "1      0      1      0  \n",
       "2      0      0      0  \n",
       "3      0      0      0  \n",
       "4      0      0      0  \n",
       "\n",
       "[5 rows x 1777 columns]"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_train_raw.head()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(3751, 1777)"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_train_raw.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<matplotlib.axes._subplots.AxesSubplot at 0x1b036d8f208>"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 1728x720 with 2 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "msno.bar(df_train_raw)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_train_raw.isnull().sum().sum()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.5422553985603839"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_train_raw['Activity'].mean()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [],
   "source": [
    "# no null values, impressive\n",
    "# according to the competition, the descriptor matrix is already normalized. Considering \n",
    "# that there seems to be a lot of one-hot encoding, using a transform on the data\n",
    "# probably won't be advisable. Classes are conveniently balanced as well\n",
    "\n",
    "X_tr = df_train_raw.drop(columns='Activity').copy()\n",
    "y_tr = df_train_raw['Activity']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [],
   "source": [
    "X_tr_train, X_tr_val, y_tr_train, y_tr_val = train_test_split(X_tr, y_tr, stratify=y_tr, random_state = 42)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Fitting 5 folds for each of 48 candidates, totalling 240 fits\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[Parallel(n_jobs=-1)]: Using backend LokyBackend with 16 concurrent workers.\n",
      "[Parallel(n_jobs=-1)]: Done  18 tasks      | elapsed:   27.6s\n",
      "[Parallel(n_jobs=-1)]: Done 168 tasks      | elapsed:  5.4min\n",
      "[Parallel(n_jobs=-1)]: Done 240 out of 240 | elapsed:  7.5min finished\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "GridSearchCV(cv=5, error_score=nan,\n",
       "             estimator=RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,\n",
       "                                              class_weight=None,\n",
       "                                              criterion='gini', max_depth=None,\n",
       "                                              max_features='auto',\n",
       "                                              max_leaf_nodes=None,\n",
       "                                              max_samples=None,\n",
       "                                              min_impurity_decrease=0.0,\n",
       "                                              min_impurity_split=None,\n",
       "                                              min_samples_leaf=1,\n",
       "                                              min_samples_split=2,\n",
       "                                              min_weight_fraction_leaf=0.0,\n",
       "                                              n_estimators=100, n_jobs=None,\n",
       "                                              oob_score=False, random_state=42,\n",
       "                                              verbose=0, warm_start=False),\n",
       "             iid='deprecated', n_jobs=-1,\n",
       "             param_grid={'ccp_alpha': [0, 0.1], 'max_depth': [20, 50, 'auto'],\n",
       "                         'max_features': [None, 'auto'],\n",
       "                         'n_estimators': [10, 50, 100, 200]},\n",
       "             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,\n",
       "             scoring=None, verbose=1)"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# from experience, it pays to decrease variance with Kaggle competitions.\n",
    "# since the data are so very clean, we can jump straight in to modeling\n",
    "\n",
    "# lets start with a Random Forest Classifier, grid searching over \n",
    "# estimators, features, and depth:\n",
    "\n",
    "rfc = RandomForestClassifier(random_state=42)\n",
    "params = {\n",
    "    'n_estimators' : [10, 50, 100, 200],\n",
    "    'max_features' : [None, 'auto'],\n",
    "    'max_depth' : [20, 50, 'auto'],\n",
    "    'ccp_alpha' : [0, 0.1]\n",
    "}\n",
    "gs_rfc = GridSearchCV(rfc, param_grid=params, cv=5, n_jobs=-1, verbose=1)\n",
    "gs_rfc.fit(X_tr_train, y_tr_train)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.8062546222258744"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_rfc.best_score_"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "RandomForestClassifier(bootstrap=True, ccp_alpha=0, class_weight=None,\n",
       "                       criterion='gini', max_depth=50, max_features=None,\n",
       "                       max_leaf_nodes=None, max_samples=None,\n",
       "                       min_impurity_decrease=0.0, min_impurity_split=None,\n",
       "                       min_samples_leaf=1, min_samples_split=2,\n",
       "                       min_weight_fraction_leaf=0.0, n_estimators=200,\n",
       "                       n_jobs=None, oob_score=False, random_state=42, verbose=0,\n",
       "                       warm_start=False)"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_rfc.best_estimator_"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.767590618336887"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_rfc.score(X_tr_val, y_tr_val)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Fitting 5 folds for each of 54 candidates, totalling 270 fits\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[Parallel(n_jobs=-1)]: Using backend LokyBackend with 16 concurrent workers.\n",
      "[Parallel(n_jobs=-1)]: Done  18 tasks      | elapsed:   31.8s\n",
      "[Parallel(n_jobs=-1)]: Done 168 tasks      | elapsed:  5.2min\n",
      "[Parallel(n_jobs=-1)]: Done 270 out of 270 | elapsed: 10.2min finished\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "GridSearchCV(cv=5, error_score=nan,\n",
       "             estimator=ExtraTreesClassifier(bootstrap=False, ccp_alpha=0.0,\n",
       "                                            class_weight=None, criterion='gini',\n",
       "                                            max_depth=None, max_features='auto',\n",
       "                                            max_leaf_nodes=None,\n",
       "                                            max_samples=None,\n",
       "                                            min_impurity_decrease=0.0,\n",
       "                                            min_impurity_split=None,\n",
       "                                            min_samples_leaf=1,\n",
       "                                            min_samples_split=2,\n",
       "                                            min_weight_fraction_leaf=0.0,\n",
       "                                            n_estimators=100, n_jobs=None,\n",
       "                                            oob_score=False, random_state=42,\n",
       "                                            verbose=0, warm_start=False),\n",
       "             iid='deprecated', n_jobs=-1,\n",
       "             param_grid={'ccp_alpha': [0, 0.1, 0.25],\n",
       "                         'max_depth': [10, 20, 'auto'],\n",
       "                         'max_features': [None, 'auto'],\n",
       "                         'n_estimators': [50, 100, 200]},\n",
       "             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,\n",
       "             scoring=None, verbose=1)"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# we seem to be somewhat overfit, so lets do the same, but with extra trees this time\n",
    "\n",
    "etc = ExtraTreesClassifier(random_state=42)\n",
    "params = {\n",
    "    'n_estimators' : [50, 100, 200],\n",
    "    'max_features' : [None, 'auto'],\n",
    "    'max_depth' : [10, 20, 'auto'],\n",
    "    'ccp_alpha' : [0, 0.1, 0.25]\n",
    "}\n",
    "gs_etc = GridSearchCV(etc, param_grid=params, cv=5, n_jobs=-1, verbose=1)\n",
    "gs_etc.fit(X_tr_train, y_tr_train)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.7998533529705505"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_etc.best_score_"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.7697228144989339"
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_etc.score(X_tr_val, y_tr_val)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'ccp_alpha': 0, 'max_depth': 20, 'max_features': 'auto', 'n_estimators': 200}"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_etc.best_params_"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Fitting 5 folds for each of 3 candidates, totalling 15 fits\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[Parallel(n_jobs=-1)]: Using backend LokyBackend with 16 concurrent workers.\n",
      "[Parallel(n_jobs=-1)]: Done  15 out of  15 | elapsed:   29.7s finished\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "GridSearchCV(cv=5, error_score=nan,\n",
       "             estimator=SVC(C=1.0, break_ties=False, cache_size=200,\n",
       "                           class_weight=None, coef0=0.0,\n",
       "                           decision_function_shape='ovr', degree=3,\n",
       "                           gamma='scale', kernel='rbf', max_iter=-1,\n",
       "                           probability=False, random_state=None, shrinking=True,\n",
       "                           tol=0.001, verbose=False),\n",
       "             iid='deprecated', n_jobs=-1, param_grid={'C': [0.1, 1, 10]},\n",
       "             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,\n",
       "             scoring=None, verbose=True)"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# marginally better, but not much better than the rfc.\n",
    "# lets try an SVM:\n",
    "\n",
    "svc = SVC()\n",
    "params = {\n",
    "    \"C\" : [0.1, 1, 10]\n",
    "}\n",
    "\n",
    "gs_svc = GridSearchCV(svc, param_grid=params, cv=5, n_jobs=-1, verbose=True)\n",
    "gs_svc.fit(X_tr_train, y_tr_train)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.7923926853473069"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_svc.best_score_"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "SVC(C=1, break_ties=False, cache_size=200, class_weight=None, coef0=0.0,\n",
       "    decision_function_shape='ovr', degree=3, gamma='scale', kernel='rbf',\n",
       "    max_iter=-1, probability=False, random_state=None, shrinking=True,\n",
       "    tol=0.001, verbose=False)"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_svc.best_estimator_"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.7611940298507462"
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_svc.score(X_tr_val, y_tr_val)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>D1</th>\n",
       "      <th>D2</th>\n",
       "      <th>D3</th>\n",
       "      <th>D4</th>\n",
       "      <th>D5</th>\n",
       "      <th>D6</th>\n",
       "      <th>D7</th>\n",
       "      <th>D8</th>\n",
       "      <th>D9</th>\n",
       "      <th>D10</th>\n",
       "      <th>...</th>\n",
       "      <th>D1767</th>\n",
       "      <th>D1768</th>\n",
       "      <th>D1769</th>\n",
       "      <th>D1770</th>\n",
       "      <th>D1771</th>\n",
       "      <th>D1772</th>\n",
       "      <th>D1773</th>\n",
       "      <th>D1774</th>\n",
       "      <th>D1775</th>\n",
       "      <th>D1776</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0.366667</td>\n",
       "      <td>0.611765</td>\n",
       "      <td>0.05</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.110435</td>\n",
       "      <td>0.803973</td>\n",
       "      <td>0.106075</td>\n",
       "      <td>0.473965</td>\n",
       "      <td>0.835617</td>\n",
       "      <td>0.106452</td>\n",
       "      <td>...</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0.100000</td>\n",
       "      <td>0.758175</td>\n",
       "      <td>0.30</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.180128</td>\n",
       "      <td>0.621378</td>\n",
       "      <td>0.287144</td>\n",
       "      <td>0.503919</td>\n",
       "      <td>0.674919</td>\n",
       "      <td>0.403616</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0.100000</td>\n",
       "      <td>0.658812</td>\n",
       "      <td>0.10</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.243421</td>\n",
       "      <td>0.640959</td>\n",
       "      <td>0.312765</td>\n",
       "      <td>0.279784</td>\n",
       "      <td>0.686775</td>\n",
       "      <td>0.280301</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0.100000</td>\n",
       "      <td>0.655752</td>\n",
       "      <td>0.10</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.226978</td>\n",
       "      <td>0.776996</td>\n",
       "      <td>0.150657</td>\n",
       "      <td>0.336948</td>\n",
       "      <td>0.802121</td>\n",
       "      <td>0.125608</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.484851</td>\n",
       "      <td>0.00</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.561200</td>\n",
       "      <td>0.771463</td>\n",
       "      <td>0.244287</td>\n",
       "      <td>0.293096</td>\n",
       "      <td>0.717575</td>\n",
       "      <td>0.230842</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows Ã— 1776 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "         D1        D2    D3   D4        D5        D6        D7        D8  \\\n",
       "0  0.366667  0.611765  0.05  0.0  0.110435  0.803973  0.106075  0.473965   \n",
       "1  0.100000  0.758175  0.30  0.0  0.180128  0.621378  0.287144  0.503919   \n",
       "2  0.100000  0.658812  0.10  0.0  0.243421  0.640959  0.312765  0.279784   \n",
       "3  0.100000  0.655752  0.10  0.0  0.226978  0.776996  0.150657  0.336948   \n",
       "4  0.000000  0.484851  0.00  0.0  0.561200  0.771463  0.244287  0.293096   \n",
       "\n",
       "         D9       D10  ...  D1767  D1768  D1769  D1770  D1771  D1772  D1773  \\\n",
       "0  0.835617  0.106452  ...      1      1      1      1      0      1      0   \n",
       "1  0.674919  0.403616  ...      0      0      0      0      0      0      0   \n",
       "2  0.686775  0.280301  ...      0      0      0      0      0      0      0   \n",
       "3  0.802121  0.125608  ...      0      0      0      0      0      0      0   \n",
       "4  0.717575  0.230842  ...      0      0      0      0      0      0      0   \n",
       "\n",
       "   D1774  D1775  D1776  \n",
       "0      0      1      0  \n",
       "1      0      0      0  \n",
       "2      0      0      0  \n",
       "3      0      0      0  \n",
       "4      0      0      0  \n",
       "\n",
       "[5 rows x 1776 columns]"
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# so far, the etc model performs the best. Lets upload a test set to kaggle\n",
    "\n",
    "kag_test = pd.read_csv('./data/test.csv')\n",
    "kag_test.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [],
   "source": [
    "submission = gs_etc.predict_proba(kag_test)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(2501, 2)"
      ]
     },
     "execution_count": 32,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "submission.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>zero</th>\n",
       "      <th>one</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0.085000</td>\n",
       "      <td>0.915000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0.183719</td>\n",
       "      <td>0.816281</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0.412974</td>\n",
       "      <td>0.587026</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0.024604</td>\n",
       "      <td>0.975396</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0.863750</td>\n",
       "      <td>0.136250</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "       zero       one\n",
       "0  0.085000  0.915000\n",
       "1  0.183719  0.816281\n",
       "2  0.412974  0.587026\n",
       "3  0.024604  0.975396\n",
       "4  0.863750  0.136250"
      ]
     },
     "execution_count": 44,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sub = pd.DataFrame(submission, columns=['zero', 'one'])\n",
    "sub.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 51,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>MoleculeId</th>\n",
       "      <th>PredictedProbability</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>0.915000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>0.816281</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>0.587026</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>4</td>\n",
       "      <td>0.975396</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5</td>\n",
       "      <td>0.136250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>6</td>\n",
       "      <td>0.649762</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>7</td>\n",
       "      <td>0.942880</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>8</td>\n",
       "      <td>0.731235</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>9</td>\n",
       "      <td>0.910453</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>10</td>\n",
       "      <td>0.446029</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   MoleculeId  PredictedProbability\n",
       "0           1              0.915000\n",
       "1           2              0.816281\n",
       "2           3              0.587026\n",
       "3           4              0.975396\n",
       "4           5              0.136250\n",
       "5           6              0.649762\n",
       "6           7              0.942880\n",
       "7           8              0.731235\n",
       "8           9              0.910453\n",
       "9          10              0.446029"
      ]
     },
     "execution_count": 51,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "kag_sub = pd.DataFrame()\n",
    "kag_sub['MoleculeId'] = sub.index + 1\n",
    "kag_sub['PredictedProbability'] = sub['one']\n",
    "kag_sub.head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 52,
   "metadata": {},
   "outputs": [],
   "source": [
    "kag_sub.to_csv('Submission1.csv', index=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 54,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Fitting 5 folds for each of 243 candidates, totalling 1215 fits\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[Parallel(n_jobs=-1)]: Using backend LokyBackend with 16 concurrent workers.\n",
      "[Parallel(n_jobs=-1)]: Done  18 tasks      | elapsed:  1.1min\n",
      "[Parallel(n_jobs=-1)]: Done 168 tasks      | elapsed:  6.7min\n",
      "[Parallel(n_jobs=-1)]: Done 418 tasks      | elapsed: 12.3min\n",
      "[Parallel(n_jobs=-1)]: Done 768 tasks      | elapsed: 28.8min\n",
      "[Parallel(n_jobs=-1)]: Done 1215 out of 1215 | elapsed: 29.6min finished\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "GridSearchCV(cv=5, error_score=nan,\n",
       "             estimator=ExtraTreesClassifier(bootstrap=False, ccp_alpha=0.0,\n",
       "                                            class_weight=None, criterion='gini',\n",
       "                                            max_depth=None, max_features='auto',\n",
       "                                            max_leaf_nodes=None,\n",
       "                                            max_samples=None,\n",
       "                                            min_impurity_decrease=0.0,\n",
       "                                            min_impurity_split=None,\n",
       "                                            min_samples_leaf=1,\n",
       "                                            min_samples_split=2,\n",
       "                                            min_weight_fraction_leaf=0.0,\n",
       "                                            n_estimators=100, n_jobs=None,\n",
       "                                            oob_score=False, random_state=42,\n",
       "                                            verbose=0, warm_start=False),\n",
       "             iid='deprecated', n_jobs=-1,\n",
       "             param_grid={'max_depth': [10, 20, 'auto'],\n",
       "                         'max_features': [500, 1000, 'auto'],\n",
       "                         'max_samples': [1000, 2500, None],\n",
       "                         'min_samples_split': [2, 10, 50],\n",
       "                         'n_estimators': [100, 200, 300]},\n",
       "             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,\n",
       "             scoring=None, verbose=1)"
      ]
     },
     "execution_count": 54,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# lets try adjusting a few more parameters of the ETC gridsearch\n",
    "\n",
    "etc = ExtraTreesClassifier(random_state=42)\n",
    "params = {\n",
    "    'n_estimators' : [100, 200, 300],\n",
    "    'max_features' : [None, 'auto'],\n",
    "    'max_depth' : [10, 20, 'auto'],\n",
    "    'max_samples' : [1000, 2500, None],\n",
    "    'min_samples_split' : [2, 10, 50],\n",
    "    'max_features' : [500, 1000, 'auto']\n",
    "}\n",
    "gs_etc = GridSearchCV(etc, param_grid=params, cv=5, n_jobs=-1, verbose=1)\n",
    "gs_etc.fit(X_tr_train, y_tr_train)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 55,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.8101641561790863"
      ]
     },
     "execution_count": 55,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_etc.best_score_\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 56,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.7697228144989339"
      ]
     },
     "execution_count": 56,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_etc.score(X_tr_val, y_tr_val)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 57,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'max_depth': 20,\n",
       " 'max_features': 1000,\n",
       " 'max_samples': 1000,\n",
       " 'min_samples_split': 2,\n",
       " 'n_estimators': 200}"
      ]
     },
     "execution_count": 57,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_etc.best_params_"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 58,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Fitting 5 folds for each of 27 candidates, totalling 135 fits\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[Parallel(n_jobs=-1)]: Using backend LokyBackend with 16 concurrent workers.\n",
      "[Parallel(n_jobs=-1)]: Done  18 tasks      | elapsed:   12.3s\n",
      "[Parallel(n_jobs=-1)]: Done 135 out of 135 | elapsed:   57.9s finished\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "GridSearchCV(cv=5, error_score=nan,\n",
       "             estimator=BaggingClassifier(base_estimator=None, bootstrap=True,\n",
       "                                         bootstrap_features=False,\n",
       "                                         max_features=1.0, max_samples=1.0,\n",
       "                                         n_estimators=10, n_jobs=None,\n",
       "                                         oob_score=False, random_state=None,\n",
       "                                         verbose=0, warm_start=False),\n",
       "             iid='deprecated', n_jobs=-1,\n",
       "             param_grid={'max_features': [0.5, 0.75, 1],\n",
       "                         'max_samples': [0.5, 0.75, 1],\n",
       "                         'n_estimators': [10, 20, 50]},\n",
       "             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,\n",
       "             scoring=None, verbose=1)"
      ]
     },
     "execution_count": 58,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# lets try a bagging classifier \n",
    "\n",
    "bgc = BaggingClassifier()\n",
    "params = {\n",
    "    'n_estimators' : [10, 20, 50],\n",
    "    'max_features' : [.5, .75, 1],\n",
    "    'max_samples' : [.5, .75, 1],\n",
    "}\n",
    "gs_bgc = GridSearchCV(bgc, param_grid=params, cv=5, n_jobs=-1, verbose=1)\n",
    "gs_bgc.fit(X_tr_train, y_tr_train)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 59,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.808386693046276"
      ]
     },
     "execution_count": 59,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_bgc.best_score_"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 60,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.7814498933901919"
      ]
     },
     "execution_count": 60,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gs_bgc.score(X_tr_val, y_tr_val)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "# marginal improvement"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
